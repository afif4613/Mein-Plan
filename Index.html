<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mein System: Schule | Business | Training | Gesundheit</title>
  <style>
    :root{
      --bg:#0b0f17; --card:#121a27; --card2:#0f1622;
      --text:#e7eefc; --muted:#a8b6d1;
      --line:#24324a; --good:#30d158; --bad:#ff453a; --warn:#ffd60a;
      --accent:#7aa2ff;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:linear-gradient(180deg,#070a10 0%, var(--bg) 55%);
      color:var(--text);
    }
    header{
      position:sticky; top:0; z-index:10;
      background:rgba(11,15,23,.88); backdrop-filter: blur(10px);
      border-bottom:1px solid var(--line);
    }
    .wrap{max-width:1100px; margin:0 auto; padding:16px}
    h1{font-size:18px; margin:0}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top:10px}
    .chip{
      background:var(--card); border:1px solid var(--line);
      padding:8px 10px; border-radius:999px; color:var(--muted);
      display:flex; gap:8px; align-items:center;
    }
    .chip b{color:var(--text)}
    .btn{
      cursor:pointer; border:1px solid var(--line);
      background:var(--card); color:var(--text);
      padding:9px 12px; border-radius:10px;
    }
    .btn:hover{border-color:#3a4f77}
    .btn.primary{background:linear-gradient(180deg,#2449ff 0%, #1b2c8f 100%); border-color:#2f49ff}
    main{padding:16px}
    .grid{
      max-width:1100px; margin:0 auto;
      display:grid; gap:12px;
      grid-template-columns: repeat(12, 1fr);
      padding:0 16px 24px;
    }
    .card{
      grid-column: span 12;
      background:linear-gradient(180deg, var(--card) 0%, var(--card2) 100%);
      border:1px solid var(--line);
      border-radius:14px;
      padding:14px;
    }
    .card h2{margin:0 0 10px; font-size:16px}
    .sub{color:var(--muted); font-size:12px; margin-top:-4px; margin-bottom:10px}
    .two{grid-column: span 12}
    @media(min-width:900px){
      .two{grid-column: span 6}
      .three{grid-column: span 4}
    }
    .bar{
      height:10px; background:#0a101a; border:1px solid var(--line);
      border-radius:999px; overflow:hidden;
    }
    .bar > div{height:100%; width:0%; background:linear-gradient(90deg,var(--accent),#5ef2ff)}
    .list{display:flex; flex-direction:column; gap:8px}
    .item{
      display:flex; gap:10px; align-items:flex-start;
      padding:10px; border:1px solid var(--line); border-radius:12px;
      background:rgba(255,255,255,0.02);
    }
    .item .meta{flex:1}
    .item .title{font-weight:600}
    .item .note{color:var(--muted); font-size:12px; margin-top:2px}
    .pill{
      font-size:12px; padding:4px 8px; border-radius:999px; border:1px solid var(--line);
      color:var(--muted);
    }
    .pill.good{border-color:rgba(48,209,88,.4); color:#bff7cf}
    .pill.bad{border-color:rgba(255,69,58,.4); color:#ffd0cd}
    .actions{display:flex; gap:8px; align-items:center}
    .icon{
      cursor:pointer; border:1px solid var(--line); background:transparent; color:var(--text);
      width:36px; height:34px; border-radius:10px;
    }
    .icon:hover{border-color:#3a4f77}
    .icon.good{border-color:rgba(48,209,88,.4)}
    .icon.bad{border-color:rgba(255,69,58,.4)}
    .inputs{display:flex; gap:8px; flex-wrap:wrap}
    input, select, textarea{
      background:#0a101a; border:1px solid var(--line); color:var(--text);
      padding:10px 10px; border-radius:10px; outline:none;
    }
    input:focus, textarea:focus, select:focus{border-color:#3a4f77}
    textarea{width:100%; min-height:90px; resize:vertical}
    .split{display:flex; gap:10px; flex-wrap:wrap}
    .split > *{flex:1; min-width:220px}
    .mini{font-size:12px; color:var(--muted)}
    .hr{height:1px; background:var(--line); margin:12px 0}
    .kpi{display:flex; gap:10px; flex-wrap:wrap}
    .kpi .box{
      flex:1; min-width:170px;
      border:1px solid var(--line); border-radius:12px; padding:10px;
      background:rgba(255,255,255,0.02);
    }
    .kpi .box .v{font-size:20px; font-weight:700}
    .kpi .box .t{font-size:12px; color:var(--muted)}
    .warn{
      color:#ffeaa6; border:1px solid rgba(255,214,10,.3);
      background:rgba(255,214,10,.08);
      padding:10px; border-radius:12px; font-size:12px;
    }
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>Mein System: Schule | Powerbank | Training | Gesundheit</h1>
    <div class="row">
      <div class="chip"><span>Datum:</span> <b id="todayLabel"></b></div>
      <div class="chip"><span>PrÃ¼fung in:</span> <b id="examCountdown">Datum fehlt</b></div>
      <div class="chip"><span>Heute Score:</span> <b id="dayScore">0%</b></div>

      <button class="btn" id="btnPrev">â—€ Tag</button>
      <button class="btn" id="btnNext">Tag â–¶</button>
      <button class="btn primary" id="btnToday">Heute</button>

      <button class="btn" id="btnExport">Export</button>
      <button class="btn" id="btnImport">Import</button>
      <button class="btn" id="btnResetToday" title="Setzt nur den Tag zurÃ¼ck">Tag zurÃ¼cksetzen</button>
    </div>
  </div>
</header>

<main>
  <div class="grid">

    <!-- Tagesplan -->
    <section class="card two">
      <h2>Tagesplan (Pflicht)</h2>
      <div class="sub">Haken = erledigt, X = nicht geschafft, â†º = wieder offen. Ziel: erst Pflicht, dann Handy.</div>

      <div class="kpi">
        <div class="box"><div class="v" id="doneCount">0</div><div class="t">Erledigt</div></div>
        <div class="box"><div class="v" id="openCount">0</div><div class="t">Offen</div></div>
        <div class="box"><div class="v" id="failCount">0</div><div class="t">Nicht geschafft</div></div>
      </div>

      <div class="hr"></div>
      <div class="list" id="dailyList"></div>

      <div class="hr"></div>
      <div class="inputs">
        <select id="dailyCat">
          <option value="Schule">Schule</option>
          <option value="Powerbank">Powerbank</option>
          <option value="Training">Training</option>
          <option value="Gesundheit">Gesundheit</option>
          <option value="Organisation">Organisation</option>
        </select>
        <input id="dailyTitle" placeholder="Neue Aufgabe (z.B. 2x25 Min Mathe)" />
        <input id="dailyNote" placeholder="Notiz optional (z.B. Thema: Funktionen)" />
        <button class="btn" id="btnAddDaily">HinzufÃ¼gen</button>
      </div>
      <div class="mini">Empfehlung: 5â€“8 Aufgaben pro Tag. Du brauchst StabilitÃ¤t, nicht Perfektion.</div>
    </section>

    <!-- Woche -->
    <section class="card two">
      <h2>Wochenziele</h2>
      <div class="sub">Hier trackst du deine groÃŸen Hebel. Jede Woche abhaken.</div>
      <div class="warn">Empfehlung: 3â€“6 Wochenziele. FÃ¼r dich: Lernen, Content/Business, Training.</div>

      <div class="hr"></div>
      <div class="split">
        <div>
          <div class="mini">Woche Fortschritt</div>
          <div class="bar"><div id="weekBar"></div></div>
          <div class="mini" style="margin-top:6px">Wochenscore: <b id="weekScore">0%</b></div>
        </div>
        <div>
          <div class="mini">PrÃ¼fungsdatum eintragen</div>
          <div class="inputs">
            <input type="date" id="examDate" />
            <button class="btn" id="btnSaveExam">Speichern</button>
          </div>
        </div>
      </div>

      <div class="hr"></div>
      <div class="list" id="weeklyList"></div>

      <div class="hr"></div>
      <div class="inputs">
        <select id="weeklyCat">
          <option value="Schule">Schule</option>
          <option value="Powerbank">Powerbank</option>
          <option value="Training">Training</option>
          <option value="Gesundheit">Gesundheit</option>
        </select>
        <input id="weeklyTitle" placeholder="Neues Wochenziel (z.B. 10 LernblÃ¶cke)" />
        <button class="btn" id="btnAddWeekly">HinzufÃ¼gen</button>
        <button class="btn" id="btnNewWeek" title="Startet neue Woche und setzt Wochenhaken zurÃ¼ck">Neue Woche</button>
      </div>
    </section>

    <!-- Schule -->
    <section class="card three">
      <h2>Schule Fokus</h2>
      <div class="sub">25-Minuten-BlÃ¶cke loggen. So baust du Routine auf.</div>

      <div class="inputs">
        <select id="schoolSubject">
          <option value="Mathe">Mathe</option>
          <option value="Englisch">Englisch</option>
          <option value="EDV">EDV</option>
          <option value="CAD">CAD</option>
          <option value="Deutsch/Kommunikation">Deutsch/Kommunikation</option>
          <option value="Sonstiges">Sonstiges</option>
        </select>
        <button class="btn" id="btnAddStudy">+ 25 Min Block</button>
      </div>

      <div class="hr"></div>
      <div class="mini">Heute LernblÃ¶cke: <b id="studyToday">0</b></div>
      <div class="mini">Diese Woche LernblÃ¶cke: <b id="studyWeek">0</b></div>

      <div class="hr"></div>
      <div class="list" id="studyLog"></div>
    </section>

    <!-- Powerbank -->
    <section class="card three">
      <h2>Powerbank Business</h2>
      <div class="sub">Meilensteine. Klar, messbar, motivierend.</div>

      <div class="list" id="bizList"></div>

      <div class="hr"></div>
      <div class="inputs">
        <input id="bizMilestone" placeholder="Neuer Meilenstein (z.B. 1. Verkauf)" />
        <button class="btn" id="btnAddBiz">HinzufÃ¼gen</button>
      </div>
      <div class="mini">Tipp: Nicht zu viele. 5â€“10 Meilensteine reichen.</div>
    </section>

    <!-- Training -->
    <section class="card three">
      <h2>Training (Boxer KÃ¶rper)</h2>
      <div class="sub">Logge Einheiten. Fokus: Kraft, Ausdauer, Technik.</div>

      <div class="inputs">
        <select id="trainType">
          <option value="Technik">Technik</option>
          <option value="Kraft">Kraft</option>
          <option value="Ausdauer">Ausdauer</option>
        </select>
        <button class="btn" id="btnAddTraining">Einheit loggen</button>
      </div>

      <div class="hr"></div>
      <div class="mini">Heute Einheiten: <b id="trainToday">0</b></div>
      <div class="mini">Diese Woche Einheiten: <b id="trainWeek">0</b></div>

      <div class="hr"></div>
      <div class="list" id="trainLog"></div>
    </section>

    <!-- Gesundheit / ErnÃ¤hrung -->
    <section class="card">
      <h2>Gesundheit und ErnÃ¤hrung</h2>
      <div class="sub">Einfach tracken: Wasser, Schritte, Schlaf, Essensnotiz.</div>

      <div class="split">
        <div>
          <div class="inputs">
            <input type="number" id="water" min="0" step="0.1" placeholder="Wasser (Liter)" />
            <input type="number" id="steps" min="0" step="100" placeholder="Schritte" />
            <input type="number" id="sleep" min="0" step="0.5" placeholder="Schlaf (Stunden)" />
            <button class="btn" id="btnSaveHealth">Speichern</button>
          </div>
          <div class="mini" style="margin-top:8px">
            Minimalziele: Wasser 2L, Schlaf 7h, Schritte 7000. Wenn du nur das schaffst, wirst du stabiler.
          </div>
        </div>
        <div>
          <textarea id="foodNotes" placeholder="ErnÃ¤hrung Notizen (z.B. FrÃ¼hstÃ¼ck, Mittag, Abend, Snacks)"></textarea>
          <div class="row" style="margin-top:8px">
            <button class="btn" id="btnSaveFood">Notiz speichern</button>
            <button class="btn" id="btnClearFood">Notiz leeren</button>
          </div>
        </div>
      </div>
    </section>

  </div>
</main>

<script>
  const $ = (id) => document.getElementById(id);
  const pad = (n) => String(n).padStart(2,'0');
  const toISO = (d) => `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
  const fromISO = (s) => { const [y,m,dd] = s.split('-').map(Number); return new Date(y, m-1, dd); };
  function startOfWeek(d){
    const x = new Date(d);
    const day = (x.getDay()+6)%7; // Mon=0
    x.setDate(x.getDate()-day); x.setHours(0,0,0,0);
    return x;
  }
  function weekKey(d){ return `week:${toISO(startOfWeek(d))}`; }
  function formatDate(d){
    const days = ["So","Mo","Di","Mi","Do","Fr","Sa"];
    return `${days[d.getDay()]}, ${pad(d.getDate())}.${pad(d.getMonth()+1)}.${d.getFullYear()}`;
  }
  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, m => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
    }[m]));
  }

  const KEY = "mein_system_v1";
  const defaultState = () => ({
    selectedDate: toISO(new Date()),
    examDate: "",
    dailyByDate: {},
    weeklyByWeek: {},
    studyLog: [],
    trainLog: [],
    bizMilestones: [],
    healthByDate: {},
  });

  function load(){
    try{
      const raw = localStorage.getItem(KEY);
      if(!raw) return defaultState();
      return { ...defaultState(), ...JSON.parse(raw) };
    }catch{ return defaultState(); }
  }
  function save(){ localStorage.setItem(KEY, JSON.stringify(state)); }

  let state = load();

  function ensureDaily(dateISO){
    if(!state.dailyByDate[dateISO]){
      state.dailyByDate[dateISO] = [
        {id: crypto.randomUUID(), cat:"Schule", title:"2 Ã— 25 Min Lernen", note:"Fach auswÃ¤hlen", status:null},
        {id: crypto.randomUUID(), cat:"Powerbank", title:"30 Min Output (drehen/posten/antworten)", note:"1 Task", status:null},
        {id: crypto.randomUUID(), cat:"Training", title:"20â€“45 Min Training", note:"Technik/Kraft/Ausdauer", status:null},
        {id: crypto.randomUUID(), cat:"Organisation", title:"Schul Orga / Hausaufgaben", note:"10â€“20 Min", status:null},
        {id: crypto.randomUUID(), cat:"Gesundheit", title:"Wasser + Schlaf im Blick", note:"2L / 7h", status:null},
      ];
    }
  }
  function ensureWeekly(wk){
    if(!state.weeklyByWeek[wk]){
      state.weeklyByWeek[wk] = [
        {id: crypto.randomUUID(), cat:"Schule", title:"10 LernblÃ¶cke (25 Min)", done:false},
        {id: crypto.randomUUID(), cat:"Powerbank", title:"15 Videos posten", done:false},
        {id: crypto.randomUUID(), cat:"Training", title:"5 Einheiten", done:false},
      ];
    }
  }
  function ensureBiz(){
    if(!state.bizMilestones || state.bizMilestones.length===0){
      state.bizMilestones = [
        {id: crypto.randomUUID(), title:"Erste Anfrage", done:false},
        {id: crypto.randomUUID(), title:"Erster Verkauf", done:false},
        {id: crypto.randomUUID(), title:"10 VerkÃ¤ufe", done:false},
      ];
    }
  }

  function renderExamCountdown(){
    if(!state.examDate){ $("examCountdown").textContent = "Datum fehlt"; return; }
    const today = fromISO(state.selectedDate);
    const ex = fromISO(state.examDate);
    const diff = Math.ceil((ex - today) / (1000*60*60*24));
    $("examCountdown").textContent = diff >= 0 ? `${diff} Tage` : `vorbei`;
  }

  function renderDaily(){
    const list = $("dailyList"); list.innerHTML = "";
    const items = state.dailyByDate[state.selectedDate];

    items.forEach(it => {
      const el = document.createElement("div");
      el.className = "item";
      const statusPill = it.status === true ? `<span class="pill good">Erledigt</span>`
        : it.status === false ? `<span class="pill bad">Nicht geschafft</span>`
        : `<span class="pill">Offen</span>`;

      el.innerHTML = `
        <div class="meta">
          <div class="title">${escapeHtml(it.title)} <span class="pill">${escapeHtml(it.cat)}</span> ${statusPill}</div>
          <div class="note">${escapeHtml(it.note || "")}</div>
        </div>
        <div class="actions">
          <button class="icon good" title="Erledigt">âœ“</button>
          <button class="icon bad" title="Nicht geschafft">âœ•</button>
          <button class="icon" title="Wieder offen">â†º</button>
          <button class="icon" title="LÃ¶schen">ðŸ—‘</button>
        </div>
      `;

      const [btnDone, btnFail, btnReset, btnDel] = el.querySelectorAll("button");
      btnDone.onclick = () => { it.status = true; render(); };
      btnFail.onclick = () => { it.status = false; render(); };
      btnReset.onclick = () => { it.status = null; render(); };
      btnDel.onclick = () => {
        state.dailyByDate[state.selectedDate] = items.filter(x => x.id !== it.id);
        render();
      };
      list.appendChild(el);
    });
  }

  function renderWeekly(wk){
    const list = $("weeklyList"); list.innerHTML = "";
    const items = state.weeklyByWeek[wk];

    items.forEach(it => {
      const el = document.createElement("div");
      el.className = "item";
      el.innerHTML = `
        <div class="meta">
          <div class="title">${escapeHtml(it.title)} <span class="pill">${escapeHtml(it.cat)}</span> ${it.done ? `<span class="pill good">Erledigt</span>` : `<span class="pill">Offen</span>`}</div>
        </div>
        <div class="actions">
          <button class="icon good" title="Toggle">âœ“</button>
          <button class="icon" title="LÃ¶schen">ðŸ—‘</button>
        </div>
      `;
      const [btnToggle, btnDel] = el.querySelectorAll("button");
      btnToggle.onclick = () => { it.done = !it.done; render(); };
      btnDel.onclick = () => {
        state.weeklyByWeek[wk] = items.filter(x => x.id !== it.id);
        render();
      };
      list.appendChild(el);
    });
  }

  function renderSchool(){
    const dISO = state.selectedDate;
    const wkStart = startOfWeek(fromISO(dISO));
    const wkEnd = new Date(wkStart); wkEnd.setDate(wkEnd.getDate()+7);

    const todayCount = state.studyLog.filter(x => x.dateISO === dISO).length;
    const weekCount = state.studyLog.filter(x => {
      const dt = fromISO(x.dateISO);
      return dt >= wkStart && dt < wkEnd;
    }).length;

    $("studyToday").textContent = todayCount;
    $("studyWeek").textContent = weekCount;

    const log = $("studyLog"); log.innerHTML = "";
    state.studyLog.filter(x => x.dateISO === dISO).slice(-8).reverse().forEach(x => {
      const el = document.createElement("div");
      el.className = "item";
      el.innerHTML = `
        <div class="meta">
          <div class="title">${escapeHtml(x.subject)} <span class="pill">${x.minutes} Min</span> <span class="pill good">Block</span></div>
          <div class="note">${new Date(x.ts).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</div>
        </div>
        <div class="actions"><button class="icon" title="LÃ¶schen">ðŸ—‘</button></div>
      `;
      el.querySelector("button").onclick = () => { state.studyLog = state.studyLog.filter(y => y.ts !== x.ts); render(); };
      log.appendChild(el);
    });
  }

  function renderTraining(){
    const dISO = state.selectedDate;
    const wkStart = startOfWeek(fromISO(dISO));
    const wkEnd = new Date(wkStart); wkEnd.setDate(wkEnd.getDate()+7);

    const todayCount = state.trainLog.filter(x => x.dateISO === dISO).length;
    const weekCount = state.trainLog.filter(x => {
      const dt = fromISO(x.dateISO);
      return dt >= wkStart && dt < wkEnd;
    }).length;

    $("trainToday").textContent = todayCount;
    $("trainWeek").textContent = weekCount;

    const log = $("trainLog"); log.innerHTML = "";
    state.trainLog.filter(x => x.dateISO === dISO).slice(-8).reverse().forEach(x => {
      const el = document.createElement("div");
      el.className = "item";
      el.innerHTML = `
        <div class="meta">
          <div class="title">${escapeHtml(x.type)} <span class="pill good">Einheit</span></div>
          <div class="note">${new Date(x.ts).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</div>
        </div>
        <div class="actions"><button class="icon" title="LÃ¶schen">ðŸ—‘</button></div>
      `;
      el.querySelector("button").onclick = () => { state.trainLog = state.trainLog.filter(y => y.ts !== x.ts); render(); };
      log.appendChild(el);
    });
  }

  function renderBiz(){
    const list = $("bizList"); list.innerHTML = "";
    state.bizMilestones.forEach(m => {
      const el = document.createElement("div");
      el.className = "item";
      el.innerHTML = `
        <div class="meta">
          <div class="title">${escapeHtml(m.title)} ${m.done ? `<span class="pill good">Erledigt</span>` : `<span class="pill">Offen</span>`}</div>
        </div>
        <div class="actions">
          <button class="icon good" title="Toggle">âœ“</button>
          <button class="icon" title="LÃ¶schen">ðŸ—‘</button>
        </div>
      `;
      const [btnToggle, btnDel] = el.querySelectorAll("button");
      btnToggle.onclick = () => { m.done = !m.done; render(); };
      btnDel.onclick = () => { state.bizMilestones = state.bizMilestones.filter(x => x.id !== m.id); render(); };
      list.appendChild(el);
    });
  }

  function renderHealth(){
    const h = state.healthByDate[state.selectedDate] || {};
    $("water").value = h.water ?? "";
    $("steps").value = h.steps ?? "";
    $("sleep").value = h.sleep ?? "";
    $("foodNotes").value = h.foodNotes ?? "";
    $("examDate").value = state.examDate || "";
  }

  function computeScores(wkKeyStr){
    const daily = state.dailyByDate[state.selectedDate] || [];
    const total = daily.length || 1;
    const done = daily.filter(x => x.status === true).length;
    const fail = daily.filter(x => x.status === false).length;
    const open = total - done - fail;

    $("doneCount").textContent = done;
    $("failCount").textContent = fail;
    $("openCount").textContent = open;

    $("dayScore").textContent = `${Math.round((done/total)*100)}%`;

    const weekly = state.weeklyByWeek[wkKeyStr] || [];
    const wTotal = weekly.length || 1;
    const wDone = weekly.filter(x => x.done).length;
    const weekScore = Math.round((wDone/wTotal)*100);
    $("weekScore").textContent = `${weekScore}%`;
    $("weekBar").style.width = `${weekScore}%`;
  }

  function render(){
    const d = fromISO(state.selectedDate);
    $("todayLabel").textContent = formatDate(d);
    renderExamCountdown();

    ensureDaily(state.selectedDate);
    const wk = weekKey(d);
    ensureWeekly(wk);
    ensureBiz();

    renderDaily();
    renderWeekly(wk);
    renderSchool();
    renderTraining();
    renderBiz();
    renderHealth();
    computeScores(wk);

    save();
  }

  // Navigation
  $("btnPrev").onclick = () => { const d = fromISO(state.selectedDate); d.setDate(d.getDate()-1); state.selectedDate = toISO(d); render(); };
  $("btnNext").onclick = () => { const d = fromISO(state.selectedDate); d.setDate(d.getDate()+1); state.selectedDate = toISO(d); render(); };
  $("btnToday").onclick = () => { state.selectedDate = toISO(new Date()); render(); };

  // Daily add
  $("btnAddDaily").onclick = () => {
    const cat = $("dailyCat").value;
    const title = $("dailyTitle").value.trim();
    const note = $("dailyNote").value.trim();
    if(!title) return;
    state.dailyByDate[state.selectedDate].push({id: crypto.randomUUID(), cat, title, note, status:null});
    $("dailyTitle").value = ""; $("dailyNote").value = "";
    render();
  };

  // Weekly add
  $("btnAddWeekly").onclick = () => {
    const cat = $("weeklyCat").value;
    const title = $("weeklyTitle").value.trim();
    if(!title) return;
    const wk = weekKey(fromISO(state.selectedDate));
    state.weeklyByWeek[wk].push({id: crypto.randomUUID(), cat, title, done:false});
    $("weeklyTitle").value = "";
    render();
  };

  $("btnNewWeek").onclick = () => {
    const wk = weekKey(fromISO(state.selectedDate));
    state.weeklyByWeek[wk].forEach(x => x.done = false);
    render();
  };

  // Exam date
  $("btnSaveExam").onclick = () => { state.examDate = $("examDate").value || ""; render(); };

  // Study block
  $("btnAddStudy").onclick = () => {
    const subject = $("schoolSubject").value;
    state.studyLog.push({ts: Date.now(), dateISO: state.selectedDate, subject, minutes: 25});
    render();
  };

  // Training log
  $("btnAddTraining").onclick = () => {
    const type = $("trainType").value;
    state.trainLog.push({ts: Date.now(), dateISO: state.selectedDate, type});
    render();
  };

  // Business milestones
  $("btnAddBiz").onclick = () => {
    const title = $("bizMilestone").value.trim();
    if(!title) return;
    state.bizMilestones.push({id: crypto.randomUUID(), title, done:false});
    $("bizMilestone").value = "";
    render();
  };

  // Health
  $("btnSaveHealth").onclick = () => {
    const water = $("water").value ? Number($("water").value) : null;
    const steps = $("steps").value ? Number($("steps").value) : null;
    const sleep = $("sleep").value ? Number($("sleep").value) : null;
    state.healthByDate[state.selectedDate] = { ...(state.healthByDate[state.selectedDate] || {}), water, steps, sleep };
    render();
  };

  $("btnSaveFood").onclick = () => {
    state.healthByDate[state.selectedDate] = { ...(state.healthByDate[state.selectedDate] || {}), foodNotes: $("foodNotes").value };
    render();
  };

  $("btnClearFood").onclick = () => {
    state.healthByDate[state.selectedDate] = { ...(state.healthByDate[state.selectedDate] || {}), foodNotes: "" };
    render();
  };

  // Reset day
  $("btnResetToday").onclick = () => {
    state.dailyByDate[state.selectedDate].forEach(x => x.status = null);
    render();
  };

  // Export/Import
  $("btnExport").onclick = () => {
    const data = JSON.stringify(state, null, 2);
    const blob = new Blob([data], {type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url; a.download = "mein_system_backup.json";
    document.body.appendChild(a); a.click(); a.remove();
    URL.revokeObjectURL(url);
  };

  $("btnImport").onclick = async () => {
    const inp = document.createElement("input");
    inp.type = "file"; inp.accept = "application/json";
    inp.onchange = async () => {
      const file = inp.files[0];
      if(!file) return;
      const text = await file.text();
      try{
        state = { ...defaultState(), ...JSON.parse(text) };
        save(); render();
      }catch{
        alert("Import fehlgeschlagen. Datei ist kein gÃ¼ltiges JSON.");
      }
    };
    inp.click();
  };

  // Boot
  render();
</script>
</body>
</html>
